<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Zenderer Engine: VertexArray</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Zenderer Engine
   &#160;<span id="projectnumber">1.0.0-alpha</span>
   </div>
   <div id="projectbrief">A OpenGL-based 2D engine. Currently at 7477 lines of code.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_vertex_array-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">VertexArray</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="vao_draw"></a>
Raw Vertex Drawing</h1>
<p>Sometimes (for whatever insane reason), the need arises to write directly to the GPU in order to draw raw vertices to the screen. This example explains how that should be done.</p>
<h2><a class="anchor" id="db"></a>
The `DrawBatch` structure</h2>
<p>This is a simple structure that stores vertex and index data for offloading to the GPU. Since <em>Zenderer</em> uses an indexed rendering approach, it's necessary to supply indices to the corresponding vertices you wish to use. I won't go into serious detail, but basically the indices act as array indices for the vertex buffer. Like so:</p>
<div class="fragment"><div class="line"><span class="comment">// Imagine the GPU vertex buffer is like this:</span></div>
<div class="line">vertex_t triangle[] = {</div>
<div class="line">    { (0, 0, 0),    (0, 0), (1, 1, 1, 1) },    <span class="comment">// A simple white triangle</span></div>
<div class="line">    { (100, 0, 0),  (1, 0), (1, 1, 1, 1) },</div>
<div class="line">    { (100, 100, 0),(1, 1), (1, 1, 1, 1) }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// The indices work like so:</span></div>
<div class="line"><a name="a0"></a><a class="code" href="namespacezen_1_1gfxcore.html#a3ceaac2530cd950ed97a4bb6f2e42c5e" title="Shortcut for easy modification.">index_t</a> indices[] = {0, 1, 2};</div>
<div class="line"></div>
<div class="line"><span class="comment">// So indices[0] will draw triangle[0], and so on.</span></div>
</div><!-- fragment --><p>To draw vertex data, you need vertices and indices. You can, of course, just specify 6 vertices to get a quad (two triangles), <em>or</em> you can specify 4 vertices and re-use two of them with indices (since they are shared). To get to the point, fill up the <code>DrawBatch</code> struct with your data, and then you can pass it on to the <code>CVertexArray</code> instance for offloading.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>zen::gfxcore;</div>
<div class="line"><span class="keyword">using namespace </span>zen::math;</div>
<div class="line"></div>
<div class="line"><a name="_a1"></a><a class="code" href="namespacezen_1_1gfxcore.html#structzen_1_1gfxcore_1_1vertex__t">vertex_t</a>* vertices = <span class="keyword">new</span> <a class="code" href="namespacezen_1_1gfxcore.html#structzen_1_1gfxcore_1_1vertex__t">vertex_t</a>[4];</div>
<div class="line"><a class="code" href="namespacezen_1_1gfxcore.html#a3ceaac2530cd950ed97a4bb6f2e42c5e" title="Shortcut for easy modification.">index_t</a>* indices = <span class="keyword">new</span> <a class="code" href="namespacezen_1_1gfxcore.html#a3ceaac2530cd950ed97a4bb6f2e42c5e" title="Shortcut for easy modification.">index_t</a>[6];</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create a 32x32 red quad.</span></div>
<div class="line">vertices[1].<a name="a2"></a><a class="code" href="namespacezen_1_1gfxcore.html#a039ea684a5c58297a199d4190f926f7a" title="Vertex position.">position</a> = <a name="a3"></a><a class="code" href="namespacezen_1_1math.html#ad13384e6c7da9a29b4e646f6988a825c" title="A shortcut for the default vector implementation in the engine.">vector_t</a>(32, 0);</div>
<div class="line">vertices[2].position = <a class="code" href="namespacezen_1_1math.html#ad13384e6c7da9a29b4e646f6988a825c" title="A shortcut for the default vector implementation in the engine.">vector_t</a>(32, 32);</div>
<div class="line">vertices[3].position = <a class="code" href="namespacezen_1_1math.html#ad13384e6c7da9a29b4e646f6988a825c" title="A shortcut for the default vector implementation in the engine.">vector_t</a>(0, 32);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; 4; ++i)</div>
<div class="line">    vertices[i].color = <a name="_a4"></a><a class="code" href="structzen_1_1color4f__t.html" title="A 32-bit floating point color component (RGBA).">zen::color4f_t</a>(1, 0, 0, 1);</div>
<div class="line"></div>
<div class="line">indices[0] = 0;</div>
<div class="line">indices[1] = 1;</div>
<div class="line">indices[2] = 3;</div>
<div class="line">indices[3] = 3;</div>
<div class="line">indices[4] = 1;</div>
<div class="line">indices[5] = 2;</div>
<div class="line"></div>
<div class="line"><span class="comment">// You can also skip the dynamic allocation for the indices</span></div>
<div class="line"><span class="comment">// if you just want a quad and use zen::CQuad::GetIndexArray().</span></div>
<div class="line"><span class="comment">// const index_t&amp; indices = zen::CQuad::GetIndexArray();</span></div>
<div class="line"><span class="comment">// but then you must be careful not to delete[] them :)</span></div>
<div class="line"></div>
<div class="line"><a name="_a5"></a><a class="code" href="namespacezen_1_1gfxcore.html#structzen_1_1gfxcore_1_1_draw_batch" title="A collection of drawing data to pass to a CVertexArray.">DrawBatch</a> <a name="a6"></a><a class="code" href="_keyboard_8hpp.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a> = {vertices, 4, indices, 6};</div>
<div class="line"></div>
<div class="line"><span class="comment">// ... to be continued.</span></div>
</div><!-- fragment --><h2><a class="anchor" id="vao"></a>
Offloading to the GPU and Drawing</h2>
<p>Now we have our data to draw on the screen. Here's how that works:</p>
<div class="fragment"><div class="line"><span class="comment">// ... continued from the previous section</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Create the GPU buffers</span></div>
<div class="line">CVertexArray VAO();</div>
<div class="line">VAO.Init();</div>
<div class="line">VAO.AddData(<a class="code" href="_keyboard_8hpp.html#a350bfcb1e3cfb28ddff48ce525d4f139">D</a>);</div>
<div class="line">VAO.Offload();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Data is on the GPU now, the DrawBatch can be safely deleted.</span></div>
<div class="line"><span class="keyword">delete</span>[] vertices;</div>
<div class="line"><span class="keyword">delete</span>[] indices;</div>
<div class="line">vertices = indices = <span class="keyword">nullptr</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Drawing can be done in a loop like so (assuming a window exists)</span></div>
<div class="line">CRenderer::GetDefaultMaterial().Enable();</div>
<div class="line"><span class="keywordflow">while</span>(Window.IsOpen())</div>
<div class="line">{</div>
<div class="line">    VAO.Draw();</div>
<div class="line">    Window.Update();</div>
<div class="line">}</div>
</div><!-- fragment --><p>And there you have it, a 32x32 quad drawn directly from the GPU on the screen.</p>
<div class="fragment"></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
